generator client {
  provider = "prisma-client"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPERADMIN
  ADMIN
}

model Account {
  id           String  @id @default(uuid())
  businessName String?
  phone        String?
  location     String?
  email        String  @unique

  users User[]
  forms Form[]

  createdAt DateTime @default(now())
}

model User {
  id                  String        @id @default(uuid())
  name                String
  email               String        @unique
  password            String
  role                Role          @default(ADMIN)
  createdById         String?
  createdBy           User?         @relation("CreatedAdmins", fields: [createdById], references: [id], onDelete: SetNull)
  createdAdmins       User[]        @relation("CreatedAdmins")
  accountId           String
  account             Account       @relation(fields: [accountId], references: [id], onDelete: Cascade)
  managedUsers        ManagedUser[]
  forms               Form[]
  resetToken          String?
  resetTokenExpiresAt DateTime?
  createdAt           DateTime      @default(now())
}

model ManagedUser {
  id        String   @id @default(uuid())
  adminId   String
  name      String
  email     String?
  phone     String?
  roleTitle String?
  createdAt DateTime @default(now())

  admin User @relation(fields: [adminId], references: [id], onDelete: Cascade)
}

model Form {
  id          String      @id @default(uuid())
  formsId     String
  userId      String
  title       String
  description String?
  slug        String      @unique
  fields      FormField[]
  responses   Response[]
  createdAt   DateTime    @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  account   Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId String?
}

model FormField {
  id              String           @id @default(uuid())
  formId          String
  label           String
  type            String
  options         Json?
  required        Boolean          @default(false)
  order           Int?
  form            Form             @relation(fields: [formId], references: [id], onDelete: Cascade)
  responseAnswers ResponseAnswer[]
}

model Response {
  id          String           @id @default(uuid())
  formId      String
  submittedAt DateTime         @default(now())
  form        Form             @relation(fields: [formId], references: [id], onDelete: Cascade)
  answers     ResponseAnswer[]
}

model ResponseAnswer {
  id         String @id @default(uuid())
  responseId String
  fieldId    String
  value      String

  response Response  @relation(fields: [responseId], references: [id], onDelete: Cascade)
  field    FormField @relation(fields: [fieldId], references: [id], onDelete: Cascade)
}
